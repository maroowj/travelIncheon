<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/renew/layout}"
      xmlns:th="http://www.thymeleaf.org">

<div layout:fragment="content">
    <!--컨텐츠 영역-->

    <div class="subCont mypageWrap">
        <div class="auto pt120 pb120">
            <div class="mypageCont">
                <div class="profWrap">
                    <div class="profInfo">
                        <img id="profilePicture" src="/renew/images/none_userIme.jpg" alt="프로필사진">
                        <p class="name"><span id="name" class="black">회원</span>님</p>
                        <a href="/user/logout" class="comm-btn logoutBtn">로그아웃</a>
                    </div>
                    <ul class="menuWrap tab">
                        <li><a href="#menu1" id="inquiry" class="actived">나의 문의 내역 <i class="fa-solid fa-chevron-right"></i></a></li>
                        <li><a href="#menu2" id="insurance" >여행자 보험 내역 <i class="fa-solid fa-chevron-right"></i></a></li>
                    </ul>

                </div>
                <div class="inqWrap tabCont actived" id="menu1">
                    <div class="titleWrap">
                        <h4>나의 문의내역</h4>
                    </div>
                    <div class="totalWrap">
                        <p class="total"></p>
                    </div>
                    <ul id="inquiry-list" class="list">
                        <!--<li>
                            <a href="/mypage/inquiry">
                                <p class="date">2022.10.20</p>
                                <p class="title">VR투어 제작의뢰</p>
                                <span class="anw anw1">답변대기</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/inquiry">
                                <p class="date">2022.07.23</p>
                                <p class="title">VR투어 제작의뢰</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/inquiry">
                                <p class="date">2022.07.23</p>
                                <p class="title">VR투어 제작의뢰</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/inquiry">
                                <p class="date">2022.07.23</p>
                                <p class="title">VR투어 제작의뢰</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/inquiry">
                                <p class="date">2022.07.23</p>
                                <p class="title">VR투어 제작의뢰</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/inquiry">
                                <p class="date">2022.07.23</p>
                                <p class="title">VR투어 제작의뢰</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/inquiry">
                                <p class="date">2022.07.23</p>
                                <p class="title">VR투어 제작의뢰</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/inquiry">
                                <p class="date">2022.07.23</p>
                                <p class="title">VR투어 제작의뢰</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/inquiry">
                                <p class="date">2022.07.23</p>
                                <p class="title">VR투어 제작의뢰</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>-->
                    </ul>

                    <!--paging-->
                    <div id="pagination" class="paging pagination">
                        <!--<a href="#" class="page-arrow1 page-arrow mr05">처음 게시물 목록</a>
                        <a href="#" class="page-arrow2 page-arrow mr05">이전 게시물 목록</a>
                        <div class="page-num">
                            <a href="#" class="actived">1</a>
                            <a href="#">2</a>
                            <a href="#">3</a>
                            <a href="#">4</a>
                            <a href="#">5</a>
                            <a href="#">6</a>
                            <a href="#">7</a>
                            <a href="#">8</a>
                            <a href="#">9</a>
                            <a href="#">10</a>
                        </div>
                        <a href="#" class="page-arrow3 page-arrow mr05 ml05">다음 게시물 목록</a>
                        <a href="#" class="page-arrow4 page-arrow ">마지막 게시물 목록</a> -->
                    </div>
                </div>

                <div class="inqWrap tabCont" id="menu2">
                    <div class="titleWrap">
                        <h4>여행자 보험 내역</h4>
                    </div>
                    <div class="totalWrap">
                        <p class="total">total : 15</p>
                    </div>
                    <ul id="insurance-list" class="list">
                        <li>
                            <a href="/mypage/insurance">
                                <p class="date">2022.10.20</p>
                                <p class="title">여행자 보험 가입 문의</p>
                                <span class="anw anw1">답변대기</span>
                            </a>
                        </li>
                        <!--<li>
                            <a href="/mypage/insurance">
                                <p class="date">2022.07.23</p>
                                <p class="title">여행자 보험 가입 문의</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/insurance">
                                <p class="date">2022.07.23</p>
                                <p class="title">여행자 보험 가입 문의</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/insurance">
                                <p class="date">2022.07.23</p>
                                <p class="title">여행자 보험 가입 문의</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/insurance">
                                <p class="date">2022.07.23</p>
                                <p class="title">여행자 보험 가입 문의</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/insurance">
                                <p class="date">2022.07.23</p>
                                <p class="title">여행자 보험 가입 문의</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/insurance">
                                <p class="date">2022.07.23</p>
                                <p class="title">여행자 보험 가입 문의</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/insurance">
                                <p class="date">2022.07.23</p>
                                <p class="title">여행자 보험 가입 문의</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>
                        <li>
                            <a href="/mypage/insurance">
                                <p class="date">2022.07.23</p>
                                <p class="title">여행자 보험 가입 문의</p>
                                <span class="anw anw2">답변완료</span>
                            </a>
                        </li>-->
                    </ul>

                    <!--paging-->
                    <div id="pagination2" class="paging pagination">
                        <a href="#" class="page-arrow1 page-arrow mr05">처음 게시물 목록</a>
                        <a href="#" class="page-arrow2 page-arrow mr05">이전 게시물 목록</a>
                        <div class="page-num">
                            <a href="#" class="actived">1</a>
                            <a href="#">2</a>
                            <a href="#">3</a>
                            <a href="#">4</a>
                            <a href="#">5</a>
                            <a href="#">6</a>
                            <a href="#">7</a>
                            <a href="#">8</a>
                            <a href="#">9</a>
                            <a href="#">10</a>
                        </div>
                        <a href="#" class="page-arrow3 page-arrow mr05 ml05">다음 게시물 목록</a>
                        <a href="#" class="page-arrow4 page-arrow ">마지막 게시물 목록</a>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!--script START-->
    <script>
        let page=1;

        $(document).ready(function(){
            if(!chkLogin) {
                $(".joinModal").css("display", "block");
            }

            if(memberName!=null && memberName!="" && memberName!=undefined) {
                $("#name").text(memberName);
            }
            if(profilePicture!=null && profilePicture!="" && profilePicture!=undefined) {
                $("#profilePicture").attr("src", profilePicture);
            }
            getInquiry();
        });

        function getInquiry() {
            $.ajax({
                type:"get",
                url:"/api/user/inquiry",
                async:false,
                data:{
                    "page":page-1
                },
                success:function(data) {
                    console.log(data);
                    let total = data.totalElements;
                    $(".total").text("total: "+total);
                    let list = data.content;
                    let tag = '';
                    if(list.length!=0) {
                        for(i=0; i<list.length; i++) {
                            let answer = '';
                            if(list[i].answer!=null && list[i].answer!='') {
                                answer = '<span class="anw anw2">답변완료</span>';
                            }else {
                                answer = '<span class="anw anw1">답변대기</span>';
                            }
                            tag += '<li>' +
                                '<a href="/mypage/inquiry/'+list[i].inquirySeq+'">' +
                                '<p class="date">'+list[i].createDate+'</p>' +
                                '<p class="title">'+list[i].serviceType+' VR투어 제작의뢰</p>' +
                                 answer +
                                '</a>' +
                                '</li>';
                        }
                        fPagination2(data, page);
                    }else{
                        tag = '<li><a><p class="date"></p><p class="title" style="text-align: center; font-size: 16px; margin-right: 80px;">문의 내역이 없습니다.</p></a></li>'
                    }
                    $("#inquiry-list").html(tag);
                },
                error: function (request, status, error) {
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });
        }

        $("#pagination").on("click", "a", function() {
            page = parseInt($(this).attr("gopage"));
            getInquiry();
        });

        $("#pagination2").on("click", "a", function() {
            page = parseInt($(this).attr("gopage"));
            getInsurance();
        });

        function getInsurance() {
            $.ajax({
                type:"get",
                url:"/api/user/form",
                async:false,
                data:{
                    "page":page-1
                },
                success:function(data) {
                    console.log(data);
                    let total = data.totalElements;
                    $(".total").text("total: "+total);
                    let list = data.content;
                    let tag = '';
                    if(list.length!=0) {
                        for(i=0; i<list.length; i++) {
                            let answer = '';
                            if(list[i].answer!=null && list[i].answer!='') {
                                answer = '<span class="anw anw2">답변완료</span>';
                            }else {
                                answer = '<span class="anw anw1">답변대기</span>';
                            }
                            tag += '<li>' +
                                '<a href="/mypage/insurance/'+list[i].formSeq+'">' +
                                '<p class="date">'+list[i].createDate+'</p>' +
                                '<p class="title">여행자 보험 가입 문의</p>' +
                                answer +
                                '</a>' +
                                '</li>';
                        }
                        fPagination2(data, page);
                    }else{
                        tag = '<li><a><p class="date"></p><p class="title" style="text-align: center; font-size: 16px; margin-right: 80px;">문의 내역이 없습니다.</p></a></li>'
                    }
                    $("#insurance-list").html(tag);
                },
                error: function (request, status, error) {
                    console.log(request.status + ' ' + error.statusText + ' ' + request.responseText);
                }
            });
        }

        $("#inquiry").on("click", function(){
            page=1;
            getInquiry();
        });
        $("#insurance").on("click", function(){
            page=1;
            getInsurance();
        });

    </script>
    <!--script END-->
</div>
</html>