<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}"
      xmlns:th="http://www.thymeleaf.org">

<style layout:fragment="css"></style>

<div layout:fragment="content">

    <main role="main" class="main-content">
        <script>
            const main_menu = 3;
        </script>

        <!--컨텐츠 영역-->
        <div class="contents admin">
            <div class="admin-contents-title">
                <h3 class="admin-title">VR 포트폴리오 추가</h3>
            </div><!--admin-contents-title-->

            <div id="courseAdd-wrap" class="courseAdd-wrap">
                <div class="courseAdd-inner">
                    <div class="course-thumImg-wrap">
                        <img class="thumImage" src="/images/admin/test_3.jpg" alt="코스 썸네일 이미지">

                        <div class="img-button">
                            <a class="img-add-btn cupoint" onclick="$('#thumImage').click();">썸네일 이미지 등록</a>
                            <input type="file" class="d-none" id="thumImage" accept="image/*" />
                            <p class="img-size">※ 권장 이미지 사이즈 : 780x577</p>
                        </div>
                    </div>

                    <div class="courseAdd-text-wrap courseAdd2-text-wrap">
                        <div class="courseText-list courseText-list1">
                            <p class="title">제목</p>
                            <div class="add-d-flex">
                                <input type="text" name="check" data-name="제목" class="secondCourseTitle" placeholder="제목을 입력해주세요.">
                            </div>
                        </div><!--courseText-list-->

                        <div class="courseText-list courseText-list1">
                            <p class="title">카테고리</p>
                            <div class="add-d-flex">
                                <input type="text" name="check" data-name="카테고리" class="category" placeholder="카테고리를 입력해주세요.">
                            </div>
                        </div><!--courseText-list-->

                        <div class="courseText-list courseText-list2 d-none">
                            <p class="title">노출기간</p>
                            <div class="add-d-flex">
                                <input type="date" class="startDate" value="2022-12-01">
                                <span class="text">~</span>
                                <input type="date" class="endDate" value="2050-12-01">
                            </div>
                        </div><!--courseText-list-->

                        <div class="courseText-list courseText-list1">
                            <p class="title">주소</p>
                            <div class="add-d-flex">
                                <input type="text" name="check" data-name="주소" class="address" placeholder="주소를 입력해주세요.">
                            </div>
                        </div><!--courseText-list-->

                        <div class="courseText-list courseText-list1">
                            <p class="title">코스</p>
                            <div class="add-d-flex">
                                <input type="text" name="check" data-name="코스" class="courseDetail" placeholder="예) 장소1 - 장소2 - 장소3 - 장소4 - 장소5">
                            </div>
                        </div><!--courseText-list-->

                        <div class="courseText-list courseText-list3">
                            <p class="title">소요시간</p>
                            <div class="add-d-flex">
                                <div class="select-box">
                                    <select id="runningHour">
                                        <option value=0>00</option>
                                        <option value=60>01</option>
                                        <option value=120>02</option>
                                        <option value=180>03</option>
                                        <option value=240>04</option>
                                        <option value=300>05</option>
                                        <option value=360>06</option>
                                        <option value=420>07</option>
                                        <option value=480>08</option>
                                    </select>
                                </div>
                                <span class="text">시간</span>
                                <div class="select-box">
                                    <select id="runningMin">
                                        <option value=0>00</option>
                                        <option value=10>10</option>
                                        <option value=20>20</option>
                                        <option value=30 selected>30</option>
                                        <option value=40>40</option>
                                        <option value=50>50</option>
                                    </select>
                                </div>
                                <span class="text">분 소요</span>
                            </div>
                        </div><!--courseText-list-->

                        <div class="courseText-list courseText-list5 d-none">
                            <p class="title">예약가능 요일</p>
                            <ul class="check-box w25pro" style="border: 1px solid #e5e5e5;padding: 0.3em 1.2em 0.3em 0.5em;border-radius: 5px;">
                                <li>
                                    <input type="checkbox" id="mon" value="mon" name="week" checked><label for="mon">월</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="tue" value="tue" name="week"><label for="tue">화</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="wed" value="wed" name="week"><label for="wed">수</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="thu" value="thu" name="week"><label for="thu">목</label>
                                </li>
                                <li>
                                    <input type="checkbox" id="fri" value="fri" name="week"><label for="fri">금</label>
                                </li>
                            </ul>
                        </div><!--courseText-list-->

                        <div class="courseText-list courseText-list1">
                            <p class="title">메인노출순위</p>
                            <div class="add-d-flex" style="flex-wrap: wrap;">
                                <!-- <input type="number" name="check" data-name="체험비용" class="cost" placeholder="숫자만 입력해주세요. (예: 1인 3,000원 -> 3000) / '0' 입력할 경우 '무료'로 표기됩니다.">-->
                                <input type="number" name="check" min="1" data-name="체험비용" class="cost" placeholder="메인화면에 보여줄 순서를 지정하세요. 1부터">
                            </div>
                            <p class="title">동영상URL</p>
                            <div class="add-d-flex" style="flex-wrap: wrap;">
                                <input type="text" class="costOption ma-t-4px" placeholder="동영상 URL (※ http 또는 https로 시작해주세요.)" />
                            </div>
                            <p class="title">링크주소</p>
                            <div class="add-d-flex" style="flex-wrap: wrap;">
                                <input type="text" class="url ma-t-4px" placeholder="상세보기 URL (※ http 또는 https로 시작해주세요.)" />
                            </div>
                        </div><!--courseText-list-->

                        <div class="courseText-list courseText-list6">
                            <p class="title">상세페이지 이미지</p>
                            <div class="add-d-flex">
                                <textarea id="editor"></textarea>
                                <!--<input type="text">
                                <a href="#" class="find-file">파일 찾기</a>-->
                            </div>
                        </div><!--courseText-list-->

                    </div><!--courseAdd-text-wrap-->

                </div>

                <div class="courseAdd-button">
                    <a class="none-btn cupoint">취소</a>
                    <a class="save-btn cupoint" onclick="inputNullChk();">코스 저장</a>
                </div>
            </div><!--courseAdd-wrap-->

        </div><!--contents-->

    </main>

    <script>
        // 썸네일이미지등록 클릭 시
        $("#thumImage").on("change", function() {
            let file=$("#thumImage")[0].files[0];
            let url=URL.createObjectURL(file);
            $(".thumImage").attr("src", url);
        });

        // 코스저장 클릭 시
        function addCourse(){
            let formData = new FormData();

            let reservationDay = [];

            $("input[name='week']:checked").each(function(){ // 요일 체크
                reservationDay.push( $(this).val() );
            });

            formData.append("secondCourseTitle", $("#courseAdd-wrap .secondCourseTitle").val());
            formData.append("category", $("#courseAdd-wrap .category").val());
            formData.append("startDate", $("#courseAdd-wrap .startDate").val());
            formData.append("endDate", $("#courseAdd-wrap .endDate").val());
            formData.append("address", $("#courseAdd-wrap .address").val());
            formData.append("course", $("#courseAdd-wrap .courseDetail").val());
            formData.append("runningTime", parseInt($("#runningHour option:selected").val()) + parseInt($("#runningMin option:selected").val()));
            formData.append("reservationDay", reservationDay);
            formData.append("cost",  $("#courseAdd-wrap .cost").val());
            formData.append("costOption", $("#courseAdd-wrap .costOption").val());
            formData.append("link", $("#courseAdd-wrap .url").val());

            if($("#thumImage")[0].files[0] != undefined) formData.append("thumbnailImage", $("#thumImage")[0].files[0]);

            if(editor.getData()!=""){
                formData.append("descriptionImage", editor.getData());
            }

            // FormData의 값 확인
            // for (var pair of formData.entries()) {
            //     console.log(pair[0] + ', ' + pair[1]);
            // }


            // return;

            $.ajax({
                type: "POST",
                url: "/api/admin/course/second/save",
                data: formData,
                processData: false,
                contentType: false,
                success: function(data){
                    toastModal("신규 2차코스가 등록되었습니다.");
                    setTimeout(() => location.href="/admin/second-course", 1000);
                }
            });
        }

        function inputNullChk(){
            let isRight = true;

            $("#courseAdd-wrap").find("input[name=check]").each(function(index, item){
                if( $(this).val().trim() == '' ) {
                    toastModal($(this).attr("data-name")+"를(을) 입력해주세요.");
                    isRight = false;
                    return false;
                }else{
                    if( $("input[name=week]:checked").length == 0 ) {
                        toastModal("예약가능한 요일을 선택해주세요.");
                        isRight = false;
                        return false;
                    }else{
                        $("input[type=date]").each(function () {
                            if ($(this).val() == "") {
                                toastModal("노출기간을 선택해주세요.");
                                isRight = false;
                                return false;
                            }
                        });
                    }
                }
            });

            if (!isRight) return;
            else addCourse();
        }
    </script>

</div>
</html>